{
  "input_file": "data/examples/BPD_Sucre_normalized_log_deg_metadata.json",
  "harmonization_config": {
    "strategies": {
      "exact": {
        "enabled": true,
        "top_k": 5,
        "threshold": 1.0,
        "priority": 1
      },
      "fuzzy": {
        "enabled": true,
        "top_k": 10,
        "threshold": 0.85,
        "priority": 2
      },
      "semantic": {
        "enabled": true,
        "top_k": 15,
        "threshold": 0.7,
        "priority": 3
      },
      "fulltext": {
        "enabled": false,
        "top_k": 5,
        "threshold": 0.6,
        "priority": 4
      }
    },
    "term_expansion": {
      "enabled": true,
      "expansion_count": 5
    },
    "dataset_description": "Lung injury in preterm infants leads to structural and functional respiratory deficits, with a risk for bronchopulmonary dysplasia (BPD) that in its most severe form is accompanied by pulmonary hypertension (PH). This study examines cellular and molecular dynamics in neonatal BPD using samples from the NICU, including preterm infants with early lung injury and distinguishing between BPD and BPD+PH phenotypes.",
    "ontology_filter": "CL,MONDO,UBERON,PATO,EFO,HPO,ORDO",
    "field_mappings": {
      "cell_type": "CL,UBERON",
      "disease": "MONDO,HPO,ORDO",
      "tissue": "UBERON,FMA",
      "chemical": "CHEBI",
      "age": "PATO",
      "sex": "PATO"
    },
    "output": {
      "format": "json",
      "include_original": true,
      "include_reasoning": true,
      "include_confidence_scores": true,
      "include_alternative_matches": true
    },
    "performance": {
      "batch_size": 100,
      "max_workers": 4,
      "timeout": 300,
      "retry_attempts": 3
    },
    "logging": {
      "level": "INFO",
      "file": "harmonization.log",
      "include_timestamps": true,
      "include_performance_metrics": true
    }
  },
  "harmonization_summary": {
    "total_fields": 5,
    "total_terms": 44,
    "total_harmonized": 0,
    "overall_success_rate": 0.0,
    "timestamp": "2025-08-13T01:42:26.813159",
    "performance_metrics": {
      "batch_size": 100,
      "strategies_used": [
        {
          "enabled": true,
          "top_k": 5,
          "threshold": 1.0,
          "priority": 1
        },
        {
          "enabled": true,
          "top_k": 10,
          "threshold": 0.85,
          "priority": 2
        },
        {
          "enabled": true,
          "top_k": 15,
          "threshold": 0.7,
          "priority": 3
        }
      ]
    }
  },
  "harmonized_fields": {
    "celltype": {
      "field_name": "celltype",
      "field_type": "cell_type",
      "total_terms": 34,
      "harmonized_terms": [],
      "failed_terms": [
        {
          "term": "Secretory -3A1",
          "reason": "Analysis failed: Unexpected error: OPENAI_API_KEY not set"
        },
        {
          "term": "-3A2",
          "reason": "Analysis failed: Unexpected error: OPENAI_API_KEY not set"
        },
        {
          "term": "RASC",
          "reason": "No candidates found by any search method for expanded queries: ['RASC']"
        },
        {
          "term": "AT2",
          "reason": "Analysis failed: Unexpected error: OPENAI_API_KEY not set"
        },
        {
          "term": "AT1",
          "reason": "Analysis failed: Unexpected error: OPENAI_API_KEY not set"
        },
        {
          "term": "Multiciliated",
          "reason": "Analysis failed: Unexpected error: OPENAI_API_KEY not set"
        },
        {
          "term": "Basal",
          "reason": "Analysis failed: Unexpected error: OPENAI_API_KEY not set"
        },
        {
          "term": "Secretory MUC5B",
          "reason": "Analysis failed: Unexpected error: OPENAI_API_KEY not set"
        },
        {
          "term": "Pulmonary venous EC",
          "reason": "Analysis failed: Unexpected error: OPENAI_API_KEY not set"
        },
        {
          "term": "abCap",
          "reason": "Analysis failed: Unexpected error: OPENAI_API_KEY not set"
        },
        {
          "term": "gCap",
          "reason": "Analysis failed: Unexpected error: OPENAI_API_KEY not set"
        },
        {
          "term": "Arterial EC",
          "reason": "Analysis failed: Unexpected error: OPENAI_API_KEY not set"
        },
        {
          "term": "aCap",
          "reason": "Analysis failed: Unexpected error: OPENAI_API_KEY not set"
        },
        {
          "term": "Systemic venous EC",
          "reason": "Analysis failed: Unexpected error: OPENAI_API_KEY not set"
        },
        {
          "term": "Lymphatic",
          "reason": "Analysis failed: Unexpected error: OPENAI_API_KEY not set"
        },
        {
          "term": "Ductal MyoFB",
          "reason": "Analysis failed: Unexpected error: OPENAI_API_KEY not set"
        },
        {
          "term": "Alveolar FB",
          "reason": "Analysis failed: Unexpected error: OPENAI_API_KEY not set"
        },
        {
          "term": "Adventitial FB",
          "reason": "Analysis failed: Unexpected error: OPENAI_API_KEY not set"
        },
        {
          "term": "Pericyte",
          "reason": "Analysis failed: Unexpected error: OPENAI_API_KEY not set"
        },
        {
          "term": "Activated FB",
          "reason": "Analysis failed: Unexpected error: OPENAI_API_KEY not set"
        },
        {
          "term": "VSMC",
          "reason": "Analysis failed: Unexpected error: OPENAI_API_KEY not set"
        },
        {
          "term": "Alveolar MyoFB",
          "reason": "Analysis failed: Unexpected error: OPENAI_API_KEY not set"
        },
        {
          "term": "Alveolar Macrophage",
          "reason": "Analysis failed: Unexpected error: OPENAI_API_KEY not set"
        },
        {
          "term": "cDC",
          "reason": "Analysis failed: Unexpected error: OPENAI_API_KEY not set"
        },
        {
          "term": "NKT Cell",
          "reason": "Analysis failed: Unexpected error: OPENAI_API_KEY not set"
        },
        {
          "term": "Monocyte",
          "reason": "Analysis failed: Unexpected error: OPENAI_API_KEY not set"
        },
        {
          "term": "Mast cell",
          "reason": "Analysis failed: Unexpected error: OPENAI_API_KEY not set"
        },
        {
          "term": "NK Cell",
          "reason": "Analysis failed: Unexpected error: OPENAI_API_KEY not set"
        },
        {
          "term": "T Cell",
          "reason": "Analysis failed: Unexpected error: OPENAI_API_KEY not set"
        },
        {
          "term": "pDC",
          "reason": "Analysis failed: Unexpected error: OPENAI_API_KEY not set"
        },
        {
          "term": "B Cell",
          "reason": "Analysis failed: Unexpected error: OPENAI_API_KEY not set"
        },
        {
          "term": "Basophil",
          "reason": "Analysis failed: Unexpected error: OPENAI_API_KEY not set"
        },
        {
          "term": "Neutrophil",
          "reason": "Analysis failed: Unexpected error: OPENAI_API_KEY not set"
        },
        {
          "term": "Plasma cell",
          "reason": "Analysis failed: Unexpected error: OPENAI_API_KEY not set"
        }
      ],
      "success_rate": 0.0,
      "ontology_filter_used": "CL,UBERON"
    },
    "condition": {
      "field_name": "condition",
      "field_type": "disease",
      "total_terms": 4,
      "harmonized_terms": [],
      "failed_terms": [
        {
          "term": "Term infant",
          "reason": "Analysis failed: Unexpected error: OPENAI_API_KEY not set"
        },
        {
          "term": "Acute preterm injury",
          "reason": "Analysis failed: Unexpected error: OPENAI_API_KEY not set"
        },
        {
          "term": "BPD+PH",
          "reason": "Analysis failed: Unexpected error: OPENAI_API_KEY not set"
        },
        {
          "term": "BPD",
          "reason": "Analysis failed: Unexpected error: OPENAI_API_KEY not set"
        }
      ],
      "success_rate": 0.0,
      "ontology_filter_used": "MONDO,HPO,ORDO"
    },
    "age": {
      "field_name": "age",
      "field_type": "age",
      "total_terms": 4,
      "harmonized_terms": [],
      "failed_terms": [
        {
          "term": "0d",
          "reason": "Analysis failed: Unexpected error: OPENAI_API_KEY not set"
        },
        {
          "term": "20d",
          "reason": "No candidates found by any search method for expanded queries: ['20d']"
        },
        {
          "term": "26wk",
          "reason": "No candidates found by any search method for expanded queries: ['26wk']"
        },
        {
          "term": "7m",
          "reason": "No candidates found by any search method for expanded queries: ['7m']"
        }
      ],
      "success_rate": 0.0,
      "ontology_filter_used": "PATO"
    },
    "sex": {
      "field_name": "sex",
      "field_type": "sex",
      "total_terms": 1,
      "harmonized_terms": [],
      "failed_terms": [
        {
          "term": "unknown",
          "reason": "Analysis failed: Unexpected error: OPENAI_API_KEY not set"
        }
      ],
      "success_rate": 0.0,
      "ontology_filter_used": "PATO"
    },
    "tissue": {
      "field_name": "tissue",
      "field_type": "tissue",
      "total_terms": 1,
      "harmonized_terms": [],
      "failed_terms": [
        {
          "term": "lung",
          "reason": "Analysis failed: Unexpected error: OPENAI_API_KEY not set"
        }
      ],
      "success_rate": 0.0,
      "ontology_filter_used": "UBERON,FMA"
    }
  },
  "original_metadata": {
    "dataset": {
      "**Dataset Metadata**": {
        "**Dataset Name**": "BPD_Sucre_normalized_log_deg.h5ad",
        "**Description**": "Lung injury in preterm infants leads to structural and functional respiratory deficits, with a risk for bronchopulmonary dysplasia (BPD) that in its most severe form is accompanied by pulmonary hypertension (PH). This study examines cellular and molecular dynamics in neonatal BPD using samples from the NICU, including preterm infants with early lung injury and distinguishing between BPD and BPD+PH phenotypes. Samples were collected from autopsy and surgical biopsy. Analysis of the endothelium revealed a unique aberrant capillary cell-state primarily in BPD+PH marked by ANKRD1 expression. Predictive signaling analysis identified deficits in the semaphorin guidance-cue signaling pathway and decreased expression of pro-angiogenic transcription factor FOXF1 within the alveolar parenchyma in neonatal lung samples with BPD/BPD+PH.",
        "**Species**": "Homo sapiens",
        "**Research Team**": "LungMAP (Sucre lab)",
        "**Publication**": "https://www.biorxiv.org/content/10.1101/2024.08.27.609955v2",
        "**Source**": "https://lungcells.app.vumc.org"
      },
      "**Indexes and Annotations**": {
        "**Donor Index** (Unique donor identifier)": "donor_id",
        "**Cell Type Index** (Cell types in dataset)": {
          "celltype": [
            "Secretory -3A1",
            "-3A2",
            "RASC",
            "AT2",
            "AT1",
            "Multiciliated",
            "Basal",
            "Secretory MUC5B",
            "Pulmonary venous EC",
            "abCap",
            "gCap",
            "Arterial EC",
            "aCap",
            "Systemic venous EC",
            "Lymphatic",
            "Ductal MyoFB",
            "Alveolar FB",
            "Adventitial FB",
            "Pericyte",
            "Activated FB",
            "VSMC",
            "Alveolar MyoFB",
            "Alveolar Macrophage",
            "cDC",
            "NKT Cell",
            "Monocyte",
            "Mast cell",
            "NK Cell",
            "T Cell",
            "pDC",
            "B Cell",
            "Basophil",
            "Neutrophil",
            "Plasma cell"
          ]
        },
        "**Covariate Index** (Covariates and annotations, e.g., diseases)": {
          "condition": [
            "Term infant",
            "Acute preterm injury",
            "BPD+PH",
            "BPD"
          ]
        },
        "**Age Index** (Age-related annotations)": {
          "age": [
            "0d",
            "20d",
            "26wk",
            "7m"
          ]
        },
        "**Sex Index** (Sex-related annotations)": {
          "sex": [
            "unknown"
          ]
        },
        "**Study Index** (Study names associated with dataset)": {},
        "**Suspension Index** (Suspension type annotations)": {},
        "**Assay Index** (Assay methods used)": {},
        "**Tissue Index** (Tissue types represented)": {
          "tissue": [
            "lung"
          ]
        },
        "**Ethnicity Index** (Self-reported ethnicity)": {},
        "**Sampling Index** (Sampling methods)": {}
      },
      "**Dataset-Specific Fields**": {
        "**Disease Stats**": "condition",
        "**Restrict Index**": [
          "broad_condition"
        ],
        "**Display Index**": [
          "condition"
        ]
      },
      "**Lineage Levels**": {
        "level_1": "celltype_lineage",
        "level_2": "celltype"
      },
      "**Differential Expression** (Disease-Study-CellType mappings)": [
        {
          "disease": "Acute preterm injury",
          "study": "lung",
          "cell_types": [
            "abCap",
            "aCap",
            "Adventitial FB",
            "Alveolar FB",
            "Arterial EC",
            "AT1",
            "cDC",
            "gCap",
            "Lymphatic",
            "Monocyte",
            "Multiciliated",
            "NK Cell",
            "Pericyte",
            "Pulmonary venous EC",
            "T Cell",
            "VSMC"
          ]
        },
        {
          "disease": "BPD",
          "study": "lung",
          "cell_types": [
            "aCap",
            "Adventitial FB",
            "Alveolar FB",
            "Alveolar Macrophage",
            "Alveolar MyoFB",
            "Arterial EC",
            "AT1",
            "AT2",
            "B Cell",
            "Basophil",
            "cDC",
            "Ductal MyoFB",
            "gCap",
            "Lymphatic",
            "Monocyte",
            "Multiciliated",
            "Neutrophil",
            "NK Cell",
            "NKT Cell",
            "pDC",
            "Pericyte",
            "Plasma cell",
            "Pulmonary venous EC",
            "RASC",
            "Secretory -3A1, -3A2",
            "T Cell",
            "VSMC"
          ]
        },
        {
          "disease": "BPD+PH",
          "study": "lung",
          "cell_types": [
            "abCap",
            "aCap",
            "Activated FB",
            "Adventitial FB",
            "Alveolar FB",
            "Arterial EC",
            "AT1",
            "AT2",
            "B Cell",
            "cDC",
            "Ductal MyoFB",
            "gCap",
            "Lymphatic",
            "Mast cell",
            "Monocyte",
            "Multiciliated",
            "NK Cell",
            "NKT Cell",
            "Pericyte",
            "Pulmonary venous EC",
            "RASC",
            "Systemic venous EC",
            "T Cell",
            "VSMC"
          ]
        }
      ],
      "**Directory Path** (File location of the dataset)": "/data/aronow/pankaj/FigChat/datasets/BPD_Sucre_normalized_log_deg",
      "**AnnData Structure**": {
        "shape": [
          43607,
          36601
        ],
        "X_dtype": "float64",
        "obs_fields": [
          "orig.ident",
          "nCount_RNA",
          "nFeature_RNA",
          "percent.mt",
          "dataset",
          "age",
          "condition",
          "broad_condition",
          "percent.rb",
          "nCount_SCT",
          "nFeature_SCT",
          "louvain",
          "celltype",
          "sub.cluster",
          "SCT_snn_res.1.4",
          "celltype_lineage",
          "donor_id",
          "tissue",
          "sex"
        ],
        "var_fields": [
          "features"
        ],
        "obsm_keys": [
          "X_umap"
        ],
        "uns_keys": [
          "disease_comparison_summary",
          "disease_stats",
          "interaction_data",
          "log1p",
          "marker_stats",
          "rank_genes_groups"
        ],
        "layers_keys": [],
        "raw": {
          "exists": true,
          "shape": [
            43607,
            36601
          ],
          "var_fields": [
            "features"
          ]
        }
      }
    },
    "notes": {
      "**Notes** (Explanation of fields and structure)": [
        "1. **Dataset Metadata**: General information about the dataset, including its name, description, species, research team, publication link, and data source.",
        "2. **Indexes and Annotations**: Metadata fields that organize and describe aspects of the dataset such as cell types, covariates, age, sex, studies, assays, tissues, and sampling methods.",
        "3. **Dataset-Specific Fields**: Includes disease statistics, restrict index for filtering, and display index for visualization preferences.",
        "4. **Lineage Levels**: Defines the lineage annotation levels specific to each dataset.",
        "5. **Differential Expression**: Information linking diseases, associated studies, and cell types involved in differential expression analysis.",
        "6. **Directory Path**: The file location where the dataset is stored.",
        "7. **AnnData Structure**: Structure of the AnnData object for the dataset."
      ]
    }
  }
}